# ===================================
# PRODUCTION ENVIRONMENT (GCP Cloud Run)
# ===================================

# Application Configuration
NODE_ENV=production
# PORT is auto-injected by Cloud Run
PORT=8080
LOG_LEVEL=info

# Database Configuration (Cloud SQL via Unix socket)
# Format: postgresql://USER:PASSWORD@localhost:5432/DB?host=/cloudsql/PROJECT:REGION:INSTANCE
# Example: postgresql://appuser:STRONG_PASSWORD@localhost:5432/galacash?host=/cloudsql/my-project:asia-southeast2:galacash-sql
# IMPORTANT: Use Secret Manager for DATABASE_URL in production
DATABASE_URL=postgresql://appuser:USE_SECRET_MANAGER@localhost:5432/galacash?host=/cloudsql/PROJECT_ID:REGION:SQL_INSTANCE

# Redis Configuration (Memorystore - Private IP via VPC Connector)
# Get the IP from: gcloud redis instances describe galacash-redis --region=REGION --format='value(host)'
# Example: redis://10.0.0.3:6379
REDIS_URL=redis://MEMORYSTORE_PRIVATE_IP:6379

# JWT Configuration (CRITICAL: Use Secret Manager)
# Generate secure keys: openssl rand -base64 64
# Store in Secret Manager and mount as environment variables
JWT_SECRET=USE_SECRET_MANAGER_FOR_THIS
JWT_REFRESH_SECRET=USE_SECRET_MANAGER_FOR_THIS

# GCP Cloud Storage Configuration
# Cloud Run uses Application Default Credentials (ADC)
# GCP_PROJECT_ID can be auto-detected on Cloud Run
GCP_PROJECT_ID=your-gcp-project-id
GCP_BUCKET_NAME=galacash-uploads-prod
# GOOGLE_APPLICATION_CREDENTIALS not needed on Cloud Run (uses ADC)
GOOGLE_APPLICATION_CREDENTIALS=

# Scheduled Jobs Configuration
# For Cloud Run Jobs or Cloud Scheduler
# Runs at 2 AM WIB every 1st of the month
BILL_GENERATION_SCHEDULE=0 2 1 * *

# CORS Configuration (Restrict to frontend domain)
# Example: https://galacash.example.com
# Use Secret Manager for this value
CORS_ORIGIN=https://your-frontend-domain.com

# ===================================
# Cloud Run Deployment Notes
# ===================================
# 1. Store sensitive values in Secret Manager:
#    - JWT_SECRET
#    - JWT_REFRESH_SECRET
#    - DATABASE_URL (or just DB password)
#    - CORS_ORIGIN
#
# 2. Mount secrets in Cloud Run:
#    gcloud run deploy SERVICE \
#      --set-secrets="JWT_SECRET=JWT_SECRET:latest,DATABASE_URL=DATABASE_URL:latest"
#
# 3. Add Cloud SQL connection:
#    --add-cloudsql-instances="PROJECT_ID:REGION:INSTANCE_NAME"
#
# 4. Attach VPC connector for Memorystore:
#    --vpc-connector="galacash-vpc-connector"
#
# 5. Service account needs IAM roles:
#    - Cloud SQL Client
#    - Secret Manager Secret Accessor
#    - Storage Object Admin
#    - Redis Client (via VPC)
#
# 6. Example full deployment:
#    gcloud run deploy galacash-api \
#      --image=REGION-docker.pkg.dev/PROJECT/REPO/galacash:latest \
#      --region=asia-southeast2 \
#      --platform=managed \
#      --allow-unauthenticated \
#      --cpu=1 --memory=512Mi \
#      --min-instances=0 --max-instances=50 \
#      --set-env-vars="NODE_ENV=production,GCP_BUCKET_NAME=galacash-uploads-prod" \
#      --set-secrets="JWT_SECRET=JWT_SECRET:latest,DATABASE_URL=DATABASE_URL:latest,CORS_ORIGIN=CORS_ORIGIN:latest" \
#      --add-cloudsql-instances="PROJECT:REGION:galacash-sql" \
#      --vpc-connector="galacash-vpc-connector"
